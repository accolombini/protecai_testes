#!/usr/bin/env python3
"""
Teste espec√≠fico: P√°gina 3 do P220 52-MP-04A.set
Validar se extrator inteligente consegue identificar checkboxes e par√¢metros textuais
"""

import sys
from pathlib import Path

# Adicionar src ao path
sys.path.insert(0, str(Path(__file__).parent.parent / 'src'))

from intelligent_relay_extractor import IntelligentRelayExtractor

def main():
    # Configura√ß√µes
    pdf_path = Path("inputs/pdf/P220 52-MP-04A.set")
    template_path = Path("outputs/checkbox_debug/templates/marcado_average.png")
    
    print("=" * 80)
    print("üî¨ TESTE: P√°gina 3 de P220 52-MP-04A.set")
    print("=" * 80)
    print()
    
    # Verificar arquivos
    if not pdf_path.exists():
        # Buscar alternativas
        pdf_dir = Path("inputs/pdf")
        matches = list(pdf_dir.glob("*P220*52-MP-04A*"))
        if matches:
            pdf_path = matches[0]
            print(f"üìÇ Arquivo encontrado: {pdf_path.name}")
        else:
            print(f"‚ùå Arquivo n√£o encontrado. Procurando P220...")
            matches = list(pdf_dir.glob("*P220*"))
            if matches:
                print(f"\nüìã Arquivos P220 dispon√≠veis:")
                for i, f in enumerate(matches[:10], 1):
                    print(f"   {i}. {f.name}")
            return
    
    if not template_path.exists():
        print(f"‚ùå Template n√£o encontrado: {template_path}")
        return
    
    # Criar extrator
    extractor = IntelligentRelayExtractor(template_checkbox_path=template_path)
    
    # Extrair par√¢metros
    df = extractor.extract(pdf_path)
    
    print()
    print("=" * 80)
    print("üìä RESULTADOS DA EXTRA√á√ÉO")
    print("=" * 80)
    print(f"Total de par√¢metros extra√≠dos: {len(df)}")
    print()
    
    if not df.empty:
        # Separar por tipo
        checkbox_params = df[df['Value'].isin(['Yes', 'No', ''])]
        value_params = df[~df['Value'].isin(['Yes', 'No', ''])]
        
        print(f"üìä ESTAT√çSTICAS:")
        print(f"   ‚Ä¢ Par√¢metros com checkbox: {len(checkbox_params)}")
        print(f"   ‚Ä¢ Par√¢metros com valores: {len(value_params)}")
        print()
        
        # Mostrar checkboxes detectados
        if len(checkbox_params) > 0:
            print("=" * 80)
            print("‚úÖ CHECKBOXES MARCADOS DETECTADOS:")
            print("=" * 80)
            for i, row in checkbox_params.iterrows():
                print(f"   ‚òí {row['Code']}: {row['Description']}")
        
        print()
        
        # Mostrar par√¢metros com valores
        if len(value_params) > 0:
            print("=" * 80)
            print("üìù PAR√ÇMETROS COM VALORES:")
            print("=" * 80)
            for i, row in value_params.head(15).iterrows():
                print(f"   {row['Code']}: {row['Description']}: {row['Value']}")
        
        print()
        print("=" * 80)
        print("üíæ AMOSTRA COMPLETA (primeiros 20):")
        print("=" * 80)
        print(df.head(20).to_string(index=False))
        
    else:
        print("‚ö†Ô∏è  Nenhum par√¢metro extra√≠do")
    
    print()
    print("=" * 80)
    print("‚úÖ Teste conclu√≠do!")
    print("=" * 80)
    print()
    print("‚ùì VALIDA√á√ÉO MANUAL:")
    print("   Compare os resultados acima com a imagem da p√°gina 3")
    print("   Verifique se todos os checkboxes marcados foram detectados")
    print("=" * 80)


if __name__ == "__main__":
    main()
